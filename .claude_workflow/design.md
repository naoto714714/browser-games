# 鳥とマメ - 設計

## 1. アーキテクチャ設計

### 1.1 ファイル構成
```
bird-and-beans/
├── index.html      # メインHTML
├── css/
│   └── style.css   # スタイルシート
└── js/
    ├── main.js     # メインエントリーポイント
    ├── game.js     # ゲームロジック制御
    ├── player.js   # 鳥の制御
    ├── bean.js     # マメの制御
    ├── ground.js   # 地面の制御
    ├── input.js    # 入力処理
    ├── render.js   # 描画処理
    └── audio.js    # 効果音処理
```

### 1.2 クラス設計

#### Game
- ゲーム全体の制御
- ゲームループ管理
- スコア・ハイスコア管理
- ゲーム状態管理（プレイ中、ゲームオーバー）

#### Player
- 鳥の位置、向き管理
- 移動処理
- 舌の状態管理（伸ばし中、戻り中、待機）
- 衝突判定

#### Bean
- マメの位置、速度管理
- 種類（通常、白、点滅）
- 落下処理
- 得点計算

#### Ground
- 30個のブロック状態管理
- 穴の生成・修復
- 鳥の移動可能判定

#### InputManager
- キーボード入力の管理
- 複数キー同時押し対応

#### Renderer
- Canvas描画
- 各要素の描画メソッド

#### AudioManager
- 効果音の管理・再生
- 必要な効果音：マメキャッチ、穴ができる、穴が埋まる、ゲームオーバー

## 2. ゲームフロー設計

### 2.1 初期化
1. Canvas設定（1280×720）
2. ゲームオブジェクト生成
3. イベントリスナー設定
4. ハイスコア読み込み

### 2.2 ゲームループ
1. 入力処理
2. 鳥の移動更新
3. 舌の状態更新
4. マメの生成・落下更新
5. 衝突判定
6. スコア更新
7. 描画

### 2.3 マメ生成ロジック
- 基本間隔で生成
- ランダムなX座標
- 種類の確率：通常80%、白15%、点滅5%
- 時間経過で落下速度増加

### 2.4 スコア計算
- Y座標に基づいて10〜300点
- 計算式：`Math.floor(10 + (720 - catchY) / 720 * 290)`

## 3. 技術的な実装方針

### 3.1 座標系
- 左上原点（0, 0）
- 鳥のサイズ：40×40px
- マメのサイズ：20×20px
- ブロックサイズ：1280/30 ≈ 42.67px幅

### 3.2 舌の実装
- 始点：鳥の位置
- 角度：向いている方向の45度
- 最大長：300px
- 伸びる速度：10px/フレーム
- 戻る：即座に（1フレーム）

### 3.3 描画スタイル
- 背景：#1a1a1a
- 地面：#333333
- 穴：#000000
- 鳥：#ff6b6b（赤系）
- 通常マメ：#4ecdc4（青緑系）
- 白マメ：#ffffff
- 点滅マメ：#ffd93d（黄色）と#ff6b6b（赤）で点滅

### 3.4 パフォーマンス考慮
- requestAnimationFrameを使用
- オブジェクトプーリングでマメを再利用
- 不要な再描画を避ける

## 4. 実装手順
1. 基本的なHTML/CSSセットアップ
2. Canvasとゲームループの実装
3. 鳥の表示と移動
4. 地面の表示
5. マメの生成と落下
6. 舌の実装
7. 衝突判定
8. スコアシステム
9. 特殊マメの効果
10. 効果音追加
11. ゲームオーバー処理
12. ハイスコア機能