# Bird and Beans ゲーム改善設計

## 1. 実装アプローチ

### 1.1 舌の機能改善
#### 最大長の変更
- `constants.js`の`TONGUE_MAX_LENGTH`を300から700に変更

#### 即座に戻る仕様
- `tongue.js`に新しいメソッド`retract()`を追加（舌を即座に戻す）
- `game.js`でマメキャッチ時に`retract()`を呼び出す

#### キー入力制御
- `input.js`にスペースキーの状態管理を追加
  - `spaceWasPressed`フラグを追加
  - キーアップ時にフラグをリセット
- `player.js`でスペースキー押し直しを検知

### 1.2 マメの効果タイミング変更
#### 効果発動タイミング
- `game.js`の舌とマメの衝突処理部分を修正
  - マメの種類に応じて効果を発動
  - 白マメ：地面の穴をランダムに埋める
  - 点滅マメ：全ての穴を埋めて、全マメをクリア

#### 地面落下時の処理
- `bean.js`の`handleBeanGroundCollision()`を修正
  - 全てのマメ種類で床を1ブロック消すように統一

### 1.3 マメの出現確率調整
- `constants.js`の`BEAN_SPAWN_PROBABILITY`を修正
  - WHITE: 0.2 → 0.15

### 1.4 スコアシステムの変更
#### ゾーン分割
- キャンバスの高さ（720px）を4等分
  - 最上部: 0〜180px → 300点
  - 上部: 180〜360px → 100点
  - 中部: 360〜540px → 30点
  - 下部: 540〜720px → 10点

#### 実装方法
- `bean.js`の`getScore()`メソッドを修正
  - 高さに基づいてゾーンを判定し、固定スコアを返す

### 1.5 移動制御の変更
#### 舌を伸ばしている間の方向制御
- `player.js`に舌の状態チェックを追加
- `moveLeft()`と`moveRight()`メソッドを修正
  - 舌が伸びている時は`direction`を変更しない

## 2. 実装上の問題点と解決策

### 問題点1: スペースキーの連続入力防止
- 解決策: キーの前フレーム状態を保持し、押し直しを検知

### 問題点2: マメの効果タイミング変更による既存ロジックの修正
- 解決策: 効果処理を地面衝突から舌衝突に移動し、地面衝突は統一処理

### 問題点3: ゾーン判定の境界値
- 解決策: 明確な境界値を定数として定義

## 3. 依存関係
- 舌の機能 → InputManager、Player、Tongue、Game
- マメの効果 → Bean、Game、Ground
- スコアシステム → Bean、constants
- 移動制御 → Player

## 4. テスト観点
1. スペースキー押しっぱなしで舌が伸び続けないこと
2. マメキャッチ時に舌が即座に戻ること
3. 白・点滅マメの効果が舌キャッチ時に発動すること
4. スコアが4段階で正しく付与されること
5. 舌を伸ばしている間、反対方向を向けないこと